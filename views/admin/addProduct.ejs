<%-include('header')-%>

<div class="container-fluid pt-4 px-4">
  <div class="row g-4">
    <div style="width: 100%;" class="col-sm-12 col-xl-6">
      <div class="bg-light rounded h-100 p-4">
        <h6 class="mb-4">ADD PRODUCT</h6>
        <% if (message) { %>
          <div class="alert alert-<%= message.type %> alert-dismissible fade show" role="alert" id="alert">
            <strong><%= message.message %></strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% } %>
<form class="mt-5" method="post" action="/admin/addProduct" enctype="multipart/form-data" onsubmit="return validateForm()" novalidate>
          <!-- Product Name -->
          <div class="mb-3">
            <label for="UrunAdi" class="form-label">Product Name</label>
            <input name="productname" type="text" class="form-control" id="UrunAdi" >
            <small id="productNameError" style="color: red;"></small>
          </div>
          <!-- Stock Quantity -->
          <div class="mb-3">
            <label class="form-label" for="UrunMiktar">Stock Quantity</label>
            <input min="1" name="stockquantity" type="number" class="form-control" id="UrunMiktar" >
            <small id="stockQuantityError" style="color: red;"></small>
          </div>
          <!-- Price -->
          <div class="mb-3">
            <label for="UrunFiyat" class="form-label">Price</label>
            <input min="1" name="price" type="number" class="form-control" id="UrunFiyat" required>
            <small id="priceError" style="color: red;"></small>
          </div>
          <!-- Description -->
          <div class="mb-3">
            <label for="UrunAciklama" class="form-label">Description</label>
            <input name="description" type="text" class="form-control" id="UrunAciklama" required>
            <small id="descriptionError" style="color: red;"></small>
          </div>
          <!-- Product Category -->
          <div class="mb-3">
            <label for="Kategori" class="form-label">Product Category</label>
            <select name="productcategory" id="Kategori" class="ms-1 d-block w-100" required>
              <% category.forEach((row) => { %>
                <% if(row.isAvailable == true){ %> 
                  <option value="<%= row.category %>"><%= row.category %></option>
                <% } %>
              <% }); %>
            </select>
            <small id="categoryError" style="color: red;"></small>
          </div>
          <!-- Product Image -->
          <div class="mb-3">
            <label for="UrunImage" class="form-label">Product Image</label>
            <input name="productimage" accept="image/*" type="file" multiple class="form-control" name="UrunImage" id="UrunImage" onchange="validateFile()">
            <div id="error" style="color: red;"></div>
          </div>
          <div class="d-flex justify-content-center">
            <button class="btn btn-primary" type="submit">ADD PRODUCT</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  function validateFile() {
    const input = document.getElementById('UrunImage');
    const files = input.files;

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const fileType = file.type;

      if (!fileType.startsWith('image/')) {
        document.getElementById('error').innerHTML = 'Invalid file type. Please upload only images.';
        input.value = ''; // Clear the input to prevent submission
        return false;
      }
    }

  function validateForm() {
    // Custom validation for Product Name
    const productName = document.getElementById('UrunAdi').value;
    if (productName.trim() === '') {
      document.getElementById('productNameError').innerHTML = 'Product Name is required.';
      return false;
    }

    // Custom validation for Stock Quantity
    const stockQuantity = document.getElementById('UrunMiktar').value;
    if (isNaN(stockQuantity) || stockQuantity < 1) {
      document.getElementById('stockQuantityError').innerHTML = 'Stock Quantity must be a positive number.';
      return false;
    }

    // Custom validation for Price
    const price = document.getElementById('UrunFiyat').value;
    if (isNaN(price) || price < 1) {
      document.getElementById('priceError').innerHTML = 'Price must be a positive number.';
      return false;
    }

    // Custom validation for Description
    const description = document.getElementById('UrunAciklama').value;
    if (description.trim() === '') {
      document.getElementById('descriptionError').innerHTML = 'Description is required.';
      return false;
    }

    // Custom validation for Product Category
    const productCategory = document.getElementById('Kategori').value;
    if (productCategory.trim() === '') {
      document.getElementById('categoryError').innerHTML = 'Product Category is required.';
      return false;
    }

    // File validation (using the existing validateFile function)
    if (!validateFile()) {
      return false;
    }

    // If all validations pass, return true to submit the form
    return true;
  }
}
</script>

<%-include('footer')-%>
